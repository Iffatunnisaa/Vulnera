<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Vulnera Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="text-white flex" style="background-color:#0F1035;">

  <!-- Sidebar -->
  <aside class="w-64 p-5" style="background-color: #263159;">
    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
      <img src="../img/logo.png" alt="Logo" style="width: 35px; height: 43px;">
      <h1 class="text-3xl font-bold" style="background:linear-gradient(45deg,#FFD66B,#FFFBEB);-webkit-background-clip:text;background-clip:text;color:transparent;-webkit-text-fill-color:transparent; margin: 0;">Vulnera</h1>
    </div>

    <ul class="space-y-4">
      <li><a href="/admin/home" class="block hover:text-blue-400">üìä Dashboard</a></li>
      <li><a href="/uploadcsv" class="block hover:text-blue-400">üìù Upload File</a></li>
      <li><a href="/logout" class="block text-red-400">Keluar</a></li>
    </ul>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-6 space-y-6">
    <!-- Top Bar -->
    <div class="flex justify-between items-center">
      <h2 class="text-xl font-semibold">Welcome, Admin üöÄ</h2>
      <input type="text" placeholder="Search..." class="px-3 py-2 rounded text-white" style="background-color: #263159;">
    </div>

    <!-- Ringkasan Status Keamanan Web Server -->
    <div>
      <h3 class="text-lg font-bold mb-4">Ringkasan Status Keamanan Web Server</h3>
      <div class="grid grid-cols-3 gap-4">
        <div class="p-4 rounded-lg shadow text-center" style="background-color: #263159;">
          <p id="totalAttack" class="text-3xl font-bold text-red-400">250</p>
          <span class="text-sm">Total Serangan (24h)</span>
        </div>
        <div class="p-4 rounded-lg shadow text-center" style="background-color: #263159;">
          <p id="totalRequest" class="text-3xl font-bold text-green-400">1000</p>
          <span class="text-sm">Total Request</span>
        </div>
        <div class="p-4 rounded-lg shadow text-center" style="background-color: #263159;">
          <p id="attackPercentage" class="text-3xl font-bold text-yellow-400">25%</p>
          <span class="text-sm">Persentase Serangan</span>
        </div>
      </div>
    </div>

    <!-- Charts -->
    <div class="grid grid-cols-3 gap-6">
      <div class="p-5 rounded-lg shadow" style="background-color: #263159;">
        <h3 class="mb-3 font-semibold">Distribusi Normal vs Serangan</h3>
        <canvas id="trafficPie"></canvas>
      </div>
      <div class="p-5 rounded-lg shadow" style="background-color: #263159;">
        <h3 class="mb-3 font-semibold">Distribusi Port Sumber (src_port)</h3>
        <canvas id="srcPortChart"></canvas>
      </div>
      <div class="p-5 rounded-lg shadow" style="background-color: #263159;">
        <h3 class="mb-3 font-semibold">Distribusi HTTP Methods</h3>
        <canvas id="httpMethodChart"></canvas>
      </div>
      <div class="p-5 rounded-lg shadow" style="background-color: #263159;">
        <h3 class="mb-3 font-semibold">Status Kode HTTP</h3>
        <canvas id="httpStatusChart"></canvas>
      </div>
      <div class="p-5 rounded-lg shadow" style="background-color: #263159;">
        <h3 class="mb-3 font-semibold">Prediksi Model (Normal vs Serangan)</h3>
        <canvas id="predictionPie"></canvas>
      </div>
      <div class="p-5 rounded-lg shadow" style="background-color: #263159;">
        <h3 class="mb-3 font-semibold">Jenis Serangan</h3>
        <canvas id="attackTypeChart"></canvas>
      </div>
      <div class="col-span-2 p-5 rounded-lg shadow" style="background-color: #263159;">
        <h3 class="mb-3 font-semibold">Tren Jumlah Request Masuk</h3>
        <canvas id="requestTrendChart"></canvas>
      </div>
    </div>
  </main>

  <!-- ChartJS Script -->
  <script>
async function loadDashboard() {
  const res = await fetch("/api/dashboard-data");
  const data = await res.json();

  // Update angka ringkasan
  document.getElementById("totalAttack").innerText = data.totalAttack;
  document.getElementById("totalRequest").innerText = data.totalRequest;
  document.getElementById("attackPercentage").innerText = data.attackPercentage + "%";

  // Traffic Pie
  new Chart(document.getElementById('trafficPie'), {
    type: 'pie',
    data: {
      labels: ['Normal', 'Serangan'],
      datasets: [{
        data: [data.totalRequest - data.totalAttack, data.totalAttack],
        backgroundColor: ['#34D399', '#F87171']
      }]
    }
  });

  // HTTP Method Chart
  new Chart(document.getElementById('httpMethodChart'), {
    type: 'bar',
    data: {
      labels: Object.keys(data.methodCount),
      datasets: [{
        label: 'Jumlah Request',
        data: Object.values(data.methodCount),
        backgroundColor: '#FBBF24'
      }]
    }
  });

  // Status Code Chart
  new Chart(document.getElementById('httpStatusChart'), {
    type: 'bar',
    data: {
      labels: Object.keys(data.statusCount),
      datasets: [{
        label: 'Jumlah',
        data: Object.values(data.statusCount),
        backgroundColor: ['#34D399','#F87171','#FBBF24','#60A5FA']
      }]
    }
  });
}
loadDashboard();
</script>
</body>
</html>
